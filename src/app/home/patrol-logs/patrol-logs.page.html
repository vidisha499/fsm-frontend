<!-- 


<ion-content [fullscreen]="true" class="premium-wrapper">
  <div class="ambient-glow glow-1"></div>
  <div class="ambient-glow glow-2"></div>

  <div class="hero-header">
    <div class="header-overlay"></div>
    <div class="header-content">
      <div class="top-row">
        <div class="back-group">
          <button (click)="goBack()" class="glass-btn">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="title-meta">
            <h1>{{ 'LIST.TITLE' | translate }}</h1>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="logs-container">
    <div *ngIf="patrolLogs && patrolLogs.length > 0; else noLogsTemplate" style="display: flex; flex-direction: column; gap: 12px;">
      <div class="log-entry-card" *ngFor="let log of patrolLogs" (click)="viewDetails(log)">
        <div style="display: flex; align-items: center; gap: 15px;">
          <div class="icon-thumb">
            <i [class]="log.patrolName?.toLowerCase().includes('foot') ? 'fas fa-hiking' : 'fas fa-binoculars'"></i>
          </div>
          <div class="log-info">
            <p class="log-title">{{ log.patrolName }} - {{ log.patrolType }}</p>
            <p class="log-date">{{ log.startTime | date:'MMM d, h:mm a' }}</p>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="status-pill" [class.completed]="log.status === 'COMPLETED'" [class.pending]="log.status !== 'COMPLETED'">
            {{ log.status }}
          </span>
          <ion-button fill="clear" color="danger" (click)="deleteLog(log.id, $event)" style="margin: 0;">
            <ion-icon slot="icon-only" name="trash-outline" style="font-size: 18px;"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <ng-template #noLogsTemplate>
      <div class="empty-state">
        <div class="empty-icon-box"><ion-icon name="document-text-outline"></ion-icon></div>
        <h3>No recent patrol logs</h3>
        <p>You haven't recorded any patrols yet.</p>
      </div>
    </ng-template>

    <button (click)="setOpen(true)" class="floating-action-btn"><i class="fas fa-plus"></i></button>
  </div>

  <ion-modal [isOpen]="isDetailModalOpen" (didDismiss)="isDetailModalOpen = false" (didPresent)="onDetailModalPresent()" style="--height: 90%; --border-radius: 30px 30px 0 0;">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar style="--background: #ffffff; padding: 10px;">
          <ion-title style="font-weight: 800; color: #061A13;">Patrol Summary</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isDetailModalOpen = false" color="danger" style="font-weight: 700;">CLOSE</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding" style="--background: #ffffff;">
        <div *ngIf="selectedPatrol">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <div style="background: #F3F4F6; padding: 15px; border-radius: 15px;">
              <p style="margin:0; font-size: 10px; color: #94a3b8; font-weight: 800;">DISTANCE</p>
              <p style="margin:0; font-size: 16px; font-weight: 800; color: #061A13;">{{selectedPatrol.distanceKm}} KM</p>
            </div>
            <div style="background: #F3F4F6; padding: 15px; border-radius: 15px;">
              <p style="margin:0; font-size: 10px; color: #94a3b8; font-weight: 800;">DURATION</p>
              <p style="margin:0; font-size: 16px; font-weight: 800; color: #061A13;">{{selectedPatrol.duration}}</p>
            </div>
          </div>

          <div style="width: 100%; height: 250px; background: #f1f5f9; border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1.5px solid #d1d5db; position: relative;">
            <div *ngIf="mapLoading" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.7); z-index: 10;">
              <ion-spinner name="crescent" color="primary"></ion-spinner>
              <p style="font-size: 12px; font-weight: 600; margin-top: 5px; color: #94a3b8;">Loading Route...</p>
            </div>
            <div id="detailMap" style="height: 100%; width: 100%;"></div>
          </div>

          <h3 style="font-size: 12px; font-weight: 800; color: #94a3b8; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Sighting Details</h3>
          
          <div *ngIf="selectedPatrol.observationData?.Details?.length > 0; else noDetails">
            <div *ngFor="let item of selectedPatrol.observationData.Details" class="sighting-summary-card">
              
              <div class="sighting-header">
                <div class="sighting-icon-box">
                  <i [class]="getCategoryIcon(item.category)"></i>
                </div>
                <div class="sighting-text-info">
                  <div class="top-meta">
                    <span class="cat-label">{{item.category | uppercase}}</span>
                    <span class="time-stamp">{{item.timestamp | date:'h:mm a'}}</span>
                  </div>
                  <p class="species-name">{{item.species || 'Unspecified Sighting'}}</p>
                  <p class="count-meta">Count: {{item.count}} • {{item.sighting_type}}</p>
                </div>
              </div>

              <div class="sighting-image-box" *ngIf="item.photos && item.photos.length > 0">
                <img [src]="item.photos[0]" />
              </div>
              
            </div>
          </div>

          <ng-template #noDetails>
            <div style="text-align: center; padding: 30px 0; color: #94a3b8;">
              <ion-icon name="eye-off-outline" style="font-size: 40px; opacity: 0.5;"></ion-icon>
              <p style="font-size: 13px; font-weight: 600; margin-top: 10px;">No sightings recorded.</p>
            </div>
          </ng-template>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="setOpen(false)" [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5, 0.8]">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar style="--background: #061A13; --color: white; padding-top: 10px;">
          <ion-title>{{ 'LIST.NEW_SESSION' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="setOpen(false)">{{ 'COMMON.CANCEL' | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <ion-item lines="none" style="--background: #f4f4f7; border-radius: 12px; margin-bottom: 5px;">
            <ion-label position="stacked" style="color: #64748b; font-weight: 700;">{{ 'LIST.METHOD' | translate }}</ion-label>
            <ion-select [(ngModel)]="selectedMethod" [placeholder]="'LIST.SELECT_PLACEHOLDER' | translate" interface="action-sheet">
              <ion-select-option value="vehicle">{{ 'LIST.VEHICLE' | translate }}</ion-select-option>
              <ion-select-option value="bicycle">{{ 'LIST.BICYCLE' | translate }}</ion-select-option>
              <ion-select-option value="on foot">{{ 'LIST.FOOT' | translate }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item lines="none" style="--background: #f4f4f7; border-radius: 12px; margin-bottom: 5px;">
            <ion-label position="stacked" style="color: #64748b; font-weight: 700;">{{ 'LIST.TYPE' | translate }}</ion-label>
            <ion-select [(ngModel)]="selectedType" [placeholder]="'LIST.SELECT_PLACEHOLDER' | translate" interface="action-sheet">
              <ion-select-option value="Regular">{{ 'LIST.REGULAR' | translate }}</ion-select-option>
              <ion-select-option value="Special">{{ 'LIST.SPECIAL' | translate }}</ion-select-option>
              <ion-select-option value="Emergency">{{ 'LIST.EMERGENCY' | translate }}</ion-select-option>
            </ion-select>
          </ion-item>
        

          <div class="slider-action-container">
  <div class="slider-track" #sliderTrack>
    <div class="slider-text">{{ isSubmitting ? 'STARTING...' : ('LIST.START_BTN' | translate) }}</div>
    <div class="slider-knob" #sliderKnob [class.slide-active]="isSubmitting">
      <ion-icon [name]="isSubmitting ? 'sync-outline' : 'chevron-forward-outline'" [class.spin-icon]="isSubmitting"></ion-icon>
    </div>
  </div>
</div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content> -->



<ion-content [fullscreen]="true" class="premium-wrapper">
  <div class="ambient-glow glow-1"></div>
  <div class="ambient-glow glow-2"></div>

  <div class="hero-header">
    <div class="header-overlay"></div>
    <div class="header-content">
      <div class="top-row">
        <div class="back-group">
          <button (click)="goBack()" class="glass-btn">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="title-meta">
            <h1>{{ 'LIST.TITLE' | translate }}</h1>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="logs-container">
    <div *ngIf="patrolLogs && patrolLogs.length > 0; else noLogsTemplate" style="display: flex; flex-direction: column; gap: 12px;">
      <div class="log-entry-card" *ngFor="let log of patrolLogs" (click)="viewDetails(log.id)">
        <div style="display: flex; align-items: center; gap: 15px;">
          <div class="icon-thumb">
            <i [class]="log.patrolName?.toLowerCase().includes('foot') ? 'fas fa-hiking' : 'fas fa-binoculars'"></i>
          </div>
          <div class="log-info">
            <p class="log-title">{{ log.patrolName }} - {{ log.patrolType }}</p>
            <p class="log-date">{{ log.startTime | date:'MMM d, h:mm a' }}</p>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="status-pill" [class.completed]="log.status === 'COMPLETED'" [class.pending]="log.status !== 'COMPLETED'">
            {{ log.status }}
          </span>
          <ion-button fill="clear" color="danger" (click)="deleteLog(log.id, $event)" style="margin: 0;">
            <ion-icon slot="icon-only" name="trash-outline" style="font-size: 18px;"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <ng-template #noLogsTemplate>
      <div class="empty-state">
        <div class="empty-icon-box"><ion-icon name="document-text-outline"></ion-icon></div>
        <h3>No recent patrol logs</h3>
        <p>You haven't recorded any patrols yet.</p>
      </div>
    </ng-template>

    <button (click)="setOpen(true)" class="floating-action-btn"><i class="fas fa-plus"></i></button>
  </div>

  <ion-modal [isOpen]="isDetailModalOpen" (didDismiss)="isDetailModalOpen = false" (didPresent)="onDetailModalPresent()" style="--height: 90%; --border-radius: 30px 30px 0 0;">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar style="--background: #ffffff; padding: 10px;">
          <ion-title style="font-weight: 800; color: #061A13;">Patrol Summary</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isDetailModalOpen = false" color="danger" style="font-weight: 700;">CLOSE</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding" style="--background: #ffffff;">
        <div *ngIf="selectedPatrol">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <div style="background: #F3F4F6; padding: 15px; border-radius: 15px;">
              <p style="margin:0; font-size: 10px; color: #94a3b8; font-weight: 800;">DISTANCE</p>
              <p style="margin:0; font-size: 16px; font-weight: 800; color: #061A13;">{{selectedPatrol.distanceKm}} KM</p>
            </div>
            <div style="background: #F3F4F6; padding: 15px; border-radius: 15px;">
              <p style="margin:0; font-size: 10px; color: #94a3b8; font-weight: 800;">DURATION</p>
              <p style="margin:0; font-size: 16px; font-weight: 800; color: #061A13;">{{selectedPatrol.duration}}</p>
            </div>
          </div>

          <div style="width: 100%; height: 250px; background: #f1f5f9; border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1.5px solid #d1d5db; position: relative;">
            <div *ngIf="mapLoading" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.7); z-index: 10;">
              <ion-spinner name="crescent" color="primary"></ion-spinner>
              <p style="font-size: 12px; font-weight: 600; margin-top: 5px; color: #94a3b8;">Loading Route...</p>
            </div>
            <div id="detailMap" style="height: 100%; width: 100%;"></div>
          </div>

          <h3 style="font-size: 12px; font-weight: 800; color: #94a3b8; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Sighting Details</h3>
          
          <div *ngIf="selectedPatrol.observationData?.Details?.length > 0; else noDetails">
            <div *ngFor="let item of selectedPatrol.observationData.Details" class="sighting-summary-card">
              
              <div class="sighting-header">
                <div class="sighting-icon-box">
                  <i [class]="getCategoryIcon(item.category)"></i>
                </div>
                <div class="sighting-text-info">
                  <div class="top-meta">
                    <span class="cat-label">{{item.category | uppercase}}</span>
                    <span class="time-stamp">{{item.timestamp | date:'h:mm a'}}</span>
                  </div>
                  <p class="species-name">{{item.species || 'Unspecified Sighting'}}</p>
                  <p class="count-meta">Count: {{item.count}} • {{item.sighting_type}}</p>
                </div>
              </div>

              <div class="sighting-image-box" *ngIf="item.photos && item.photos.length > 0">
                <img [src]="item.photos[0]" />
              </div>
              
            </div>
          </div>

          <ng-template #noDetails>
            <div style="text-align: center; padding: 30px 0; color: #94a3b8;">
              <ion-icon name="eye-off-outline" style="font-size: 40px; opacity: 0.5;"></ion-icon>
              <p style="font-size: 13px; font-weight: 600; margin-top: 10px;">No sightings recorded.</p>
            </div>
          </ng-template>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="setOpen(false)" [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5, 0.8]">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar style="--background: #061A13; --color: white; padding-top: 10px;">
          <ion-title>{{ 'LIST.NEW_SESSION' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="setOpen(false)">{{ 'COMMON.CANCEL' | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <ion-item lines="none" style="--background: #f4f4f7; border-radius: 12px; margin-bottom: 5px;">
            <ion-label position="stacked" style="color: #64748b; font-weight: 700;">{{ 'LIST.METHOD' | translate }}</ion-label>
            <ion-select [(ngModel)]="selectedMethod" [placeholder]="'LIST.SELECT_PLACEHOLDER' | translate" interface="action-sheet">
              <ion-select-option value="vehicle">{{ 'LIST.VEHICLE' | translate }}</ion-select-option>
              <ion-select-option value="bicycle">{{ 'LIST.BICYCLE' | translate }}</ion-select-option>
              <ion-select-option value="on foot">{{ 'LIST.FOOT' | translate }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item lines="none" style="--background: #f4f4f7; border-radius: 12px; margin-bottom: 5px;">
            <ion-label position="stacked" style="color: #64748b; font-weight: 700;">{{ 'LIST.TYPE' | translate }}</ion-label>
            <ion-select [(ngModel)]="selectedType" [placeholder]="'LIST.SELECT_PLACEHOLDER' | translate" interface="action-sheet">
              <ion-select-option value="Regular">{{ 'LIST.REGULAR' | translate }}</ion-select-option>
              <ion-select-option value="Special">{{ 'LIST.SPECIAL' | translate }}</ion-select-option>
              <ion-select-option value="Emergency">{{ 'LIST.EMERGENCY' | translate }}</ion-select-option>
            </ion-select>
          </ion-item>

          <div class="slider-action-container">
            <div class="slider-track" #sliderTrack>
              <div class="slider-text">{{ isSubmitting ? 'STARTING...' : ('LIST.START_BTN' | translate) }}</div>
              <div class="slider-knob" #sliderKnob [class.slide-active]="isSubmitting">
                <ion-icon [name]="isSubmitting ? 'sync-outline' : 'chevron-forward-outline'" [class.spin-icon]="isSubmitting"></ion-icon>
              </div>
            </div>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>