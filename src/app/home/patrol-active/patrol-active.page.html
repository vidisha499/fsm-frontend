
<ion-content [fullscreen]="true" class="premium-wrapper">
  <div class="ambient-glow glow-1"></div>
  <div class="ambient-glow glow-2"></div>

  <div class="hero-header">
    <div class="header-overlay"></div>
    <div class="header-content">
      <div class="top-row">
        <div class="back-group">
          <button (click)="handleEndTrip()" class="glass-btn">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="title-meta">
            <h1>{{ 'PATROL.ACTIVE' | translate }}</h1>
            <p>PANNA SITE OPERATION</p>
          </div>
        </div>
        
        <div class="live-badge-top">
          <div class="auth-badge">
            <i class="fas fa-satellite-dish"></i>
            <span>LIVE TRACKING</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card-container">
    <div class="main-card">
      
      <div class="scanner-section">
        <div class="camera-frame" (click)="takeQuickPhoto()">
          <div class="corners">
            <span class="top-l"></span><span class="top-r"></span>
            <span class="bot-l"></span><span class="bot-r"></span>
          </div>
          <div class="scanner-inner">
            <div class="scan-line" *ngIf="!capturedPhoto"></div>
            
            <img *ngIf="capturedPhoto" [src]="capturedPhoto" class="preview-img">
            <div *ngIf="!capturedPhoto" class="placeholder-content">
              <i class="fas fa-camera main-cam-icon"></i>
              <span class="cam-text">CAMERA</span>
            </div>
          </div>
        </div>
      </div>

      <div class="map-wrapper">
        <div class="map-container">
          <div id="map"></div>
          <button class="recenter-btn-glass" (click)="recenterMap()">
            <i class="fas fa-crosshairs"></i>
          </button>
        </div>
      </div>

      <div class="form-grid">
        <div class="input-pill">
          <label>DURATION</label>
          <div class="pill-content">
            <i class="fas fa-clock"></i>
            <span class="val">{{timerDisplay}}</span>
          </div>
        </div>
        <div class="input-pill">
          <label>DISTANCE</label>
          <div class="pill-content">
            <i class="fas fa-route"></i>
            <span class="val">{{totalDistanceKm.toFixed(2)}} KM</span>
          </div>
        </div>
      </div>

      <div class="grid-layout">
        <div class="grid-item-glass" (click)="openObservation('Animal')">
          <div class="icon-box animal"><i class="fas fa-paw"></i></div>
          <span>Animal</span>
        </div>
        <div class="grid-item-glass" (click)="openObservation('Water')">
          <div class="icon-box water"><i class="fas fa-droplet"></i></div>
          <span>Water</span>
        </div>
        <div class="grid-item-glass" (click)="openObservation('Impact')">
          <div class="icon-box impact"><i class="fas fa-person-hiking"></i></div>
          <span>Impact</span>
        </div>
        <div class="grid-item-glass" (click)="openObservation('Death')">
          <div class="icon-box death"><i class="fas fa-skull"></i></div>
          <span>Death</span>
        </div>
        <div class="grid-item-glass" (click)="openObservation('Felling')">
          <div class="icon-box felling"><i class="fas fa-hammer"></i></div>
          <span>Felling</span>
        </div>
        <div class="grid-item-glass" (click)="openObservation('Other')">
          <div class="icon-box other"><i class="fas fa-circle-plus"></i></div>
          <span>Other</span>
        </div>
      </div>

      <div class="slider-wrapper">
        <div class="slider-track-new" [class.finished]="isFinished">
          <div class="slider-text-bg">{{ isFinished ? 'PATROL ENDED' : 'SLIDE TO END TRIP' }}</div>
          <div class="slider-knob-left" (click)="handleEndTrip()" [class.sliding]="isSubmitting" [class.at-end]="isFinished">
            <i class="fas fa-chevron-right" *ngIf="!isSubmitting && !isFinished"></i>
            <ion-spinner name="crescent" *ngIf="isSubmitting" class="wheel-spinner"></ion-spinner>
            <i class="fas fa-check" *ngIf="isFinished"></i>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</ion-content>